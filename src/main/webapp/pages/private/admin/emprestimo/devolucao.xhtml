<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets">
    <h:body>
        <ui:composition template="/pages/private/template.xhtml">
            <ui:define name="conteudo">
                <h:form id="form-user" prependId="false" >
                    <div class="ui-fluid">
                        <p:panel id="panelDevolucao" header="#{emprestimoControlador.header}">
                            <p:messages id="messagesDevolucao" showDetail="true" closable="true" autoUpdate="true" />
                            <p:focus context="panelDevolucao"/>
                            <p:panelGrid id="gridDevolucao" 
                                         columns="3"
                                         layout="grid" 
                                         style="margin-top: 20px; margin-bottom: 10px"
                                         columnClasses="ui-grid-col-2, ui-grid-col-3, ui-grid-col-7">

                                <p:outputLabel value="Data da Devolução" for="dtDevolucao" />
                                <p:calendar id="dtDevolucao"
                                            readonly="#{emprestimoControlador.visualizar}" 
                                            value="#{emprestimoControlador.itemEmprestimo.devolucao}" 
                                            pattern="dd/MM/yyyy" 
                                            mask="true" />
                                <p:outputLabel />
                            </p:panelGrid>

                            <p:commandButton actionListener="#{emprestimoControlador.preencheDevolucao()}" 
                                             id="addEnd" 
                                             icon="ui-icon-plus" 
                                             value="Devolução" 
                                             title="Adicionar Emprestimo"
                                             process="@parent"
                                             update="devolucoes"/>

                            <p:panel style="margin-top: 10px; margin-bottom: 10px" id="devolucoes">
                                <p:dataTable paginator="true" 
                                             reflow="true"
                                             rows="10"
                                             resizeMode="fit"
                                             scrollable="true"
                                             scrollHeight="90"
                                             id="tableEmprestimo" 
                                             resizableColumns="true"
                                             var="emprestimo" 
                                             rowKey="#{emprestimo.id}"
                                             value="#{emprestimoControlador.itensSelecionados}"
                                             emptyMessage="Nenhum registro encontrado">
                                    <f:facet name="header">
                                        Lista de Devoluções
                                    </f:facet>
                                    <p:column filterStyle="width: auto" filterBy="#{emprestimo.emprestimo.pessoa.nome}" headerText="Leitor">
                                        <h:outputText value="#{emprestimo.emprestimo.pessoa.nome}" />
                                    </p:column>
                                    <p:column filterStyle="width: auto" filterBy="#{emprestimo.exemplar.publicacao.titulo}" headerText="Obra Literaria">
                                        <h:outputText value="#{emprestimo.exemplar.publicacao.titulo}" />
                                    </p:column>
                                    <p:column filterStyle="width: auto" filterBy="#{emprestimo.emprestimo.criacao}" headerText="Data Emprestimo">
                                        <h:outputText value="#{emprestimo.emprestimo.criacao}">
                                            <f:convertDateTime locale="pt-br" pattern="dd/MM/yyyy" />
                                        </h:outputText>
                                    </p:column>
                                    <p:column filterStyle="width: auto" filterBy="#{emprestimo.prazo}" headerText="Data Prazo da Devolução">
                                        <h:outputText value="#{emprestimo.prazo}">
                                            <f:convertDateTime locale="pt-br" pattern="dd/MM/yyyy" />
                                        </h:outputText>
                                    </p:column>
                                    <p:column filterStyle="width: auto" filterBy="#{emprestimo.devolucao}" headerText="Data Devolução">
                                        <h:outputText value="#{emprestimo.devolucao}">
                                            <f:convertDateTime locale="pt-br" pattern="dd/MM/yyyy" />
                                        </h:outputText>
                                    </p:column>
                                    <f:facet name="footer">
                                        Total de emprestimo: .
                                    </f:facet>
                                </p:dataTable>
                            </p:panel>
                            <p:separator/>
                            <p:panelGrid id="gridBotoes" columns="2"
                                         layout="grid"
                                         style="margin-top: 20px; margin-bottom: 40px"
                                         columnClasses="ui-grid-col-6, ui-grid-col-6"
                                         styleClass="panelgrid-noborder">
                                <p:commandButton id="botaoSalvar" process="@form" icon="ui-icon-check" value="Salvar" action="#{emprestimoControlador.salvar()}" 
                                                 update="@form" disabled="#{emprestimoControlador.visualizar}"/>
                                <p:commandButton id="botaoCancelar" process="@this" icon="ui-icon-close" value="Cancelar" action="#{emprestimoControlador.prepararLista()}" update="@form" />
                            </p:panelGrid>
                        </p:panel>
                    </div>
                </h:form>
            </ui:define>
        </ui:composition>
    </h:body>
</html>

